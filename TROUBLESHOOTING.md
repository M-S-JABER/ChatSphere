# ๐ง ุฏููู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ูุฅุตูุงุญูุง - ChatSphere

## ๐จ ูุดููุฉ: ูุง ูููู ุงุณุชูุงู ุงูุฑุณุงุฆู

### ุงูุฎุทูุฉ 1: ุงุณุชุฎุฏุงู ุฃุฏุงุฉ ุงูุชุดุฎูุต

1. **ุงุฏุฎู ุฅูู ุงูุชุทุจูู** ูู admin
2. **ุงุฐูุจ ุฅูู ูุงุฆูุฉ ุงููุณุชุฎุฏู** (ุฃููููุฉ ุงููุณุชุฎุฏู ูู ุงูุฃุนูู)
3. **ุงุฎุชุฑ "Webhook Diagnostics"**
4. **ุงุฎุชุฑ ุงูู instance** ุงููุทููุจ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ

### ุงูุฎุทูุฉ 2: ูุญุต ุญุงูุฉ ุงููุธุงู

ูู ุตูุญุฉ ุงูุชุดุฎูุตุ ุชุญูู ูู:

#### โ **Instance Status**
- **Configured**: ูุฌุจ ุฃู ูููู ุฃุฎุถุฑ
- **Active**: ูุฌุจ ุฃู ูููู ุฃุฎุถุฑ  
- **Has App Secret**: ูุฌุจ ุฃู ูููู ุฃุฎุถุฑ (ุฅุฐุง ููุช ุชุณุชุฎุฏูู)
- **Has Verify Token**: ูุฌุจ ุฃู ูููู ุฃุฎุถุฑ

#### โ๏ธ **ุฅุฐุง ูุงู ุฃู ูุคุดุฑ ุฃุญูุฑ:**
- ุงุฐูุจ ุฅูู **Settings** ูุฃุตูุญ ุงูุฅุนุฏุงุฏุงุช
- ุชุฃูุฏ ูู ุฃู ุงูู instance ูุดุท
- ุชุญูู ูู ุงูู access token ู phone number ID

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุฑุณุงูุฉ

1. **ุงุฐูุจ ุฅูู ุชุจููุจ "Test Message"**
2. **ุฃุฏุฎู ุฑูู ุงููุงุชู** (ูุน ุฑูุฒ ุงูุฏููุฉ)
3. **ุฃุฏุฎู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ**
4. **ุงุถุบุท "Send Test Message"**

#### โ **ุฅุฐุง ูุฌุญ ุงูุงุฎุชุจุงุฑ:**
- ุงููุดููุฉ ูู ุงุณุชูุงู ุงูุฑุณุงุฆูุ ูููุณ ูู ุงูุฅุฑุณุงู
- ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูู webhook ูู Meta

#### โ **ุฅุฐุง ูุดู ุงูุงุฎุชุจุงุฑ:**
- ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูู instance
- ุชุฃูุฏ ูู ุตุญุฉ ุงูู access token
- ุชุญูู ูู ุฃู ุงูู phone number ID ุตุญูุญ

### ุงูุฎุทูุฉ 4: ูุญุต ุงูุฃุญุฏุงุซ ุงูุฃุฎูุฑุฉ

1. **ุงุฐูุจ ุฅูู ุชุจููุจ "Recent Events"**
2. **ุงุจุญุซ ุนู ุฃุญุฏุงุซ webhook ุญุฏูุซุฉ**

#### โ **ุฅุฐุง ูุฌุฏุช ุฃุญุฏุงุซ:**
- ุชุญูู ูู ุงูู response status
- ุฅุฐุง ูุงู 200ุ ุงููุดููุฉ ูู ูุนุงูุฌุฉ ุงูุฑุณุงุฆู
- ุฅุฐุง ูุงู ุฎุทุฃุ ุงุชุจุน ุฑุณุงูุฉ ุงูุฎุทุฃ

#### โ **ุฅุฐุง ูู ุชุฌุฏ ุฃุญุฏุงุซ:**
- ุงููุดููุฉ ูู ุฅุนุฏุงุฏุงุช ุงูู webhook ูู Meta
- ุชุญูู ูู ุงูู webhook URL
- ุชุฃูุฏ ูู ุฃู ุงูู webhook ูููุนู ูู Meta

### ุงูุฎุทูุฉ 5: ุชุดุฎูุต ุงูู Webhook

1. **ุงุฐูุจ ุฅูู ุชุจููุจ "Debug Webhook"**
2. **ุฃุฏุฎู payload ุชุฌุฑูุจู:**

```json
{
  "entry": [
    {
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "1234567890",
                "type": "text",
                "text": {
                  "body": "Hello World"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
```

3. **ุงุถุบุท "Debug Payload"**
4. **ุชุญูู ูู ุงููุชุงุฆุฌ ูู console**

## ๐ ุชุดุฎูุต ูุชูุฏู

### ูุญุต Logs ูู ุงูุฎุงุฏู

ุงุจุญุซ ุนู ูุฐู ุงูุฑุณุงุฆู ูู console ุงูุฎุงุฏู:

```
๐ Webhook POST received for instance: {instanceId}
โ Instance found: {name} (Active: {isActive})
๐ Verifying webhook signature...
โ Webhook signature verified
๐ Parsing incoming events...
๐จ Parsed {count} events
๐ฌ Processing event from: {phone}
๐พ Saving message to database...
โ Message saved with ID: {messageId}
๐ก Broadcasting message to WebSocket clients...
โ Message broadcasted
๐ Webhook processing completed in {duration}ms
```

### ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ูุญุต ุงูู instances
SELECT id, name, is_active, webhook_behavior FROM whatsapp_instances;

-- ูุญุต ุงููุญุงุฏุซุงุช
SELECT id, phone, display_name, instance_id FROM conversations ORDER BY last_at DESC LIMIT 10;

-- ูุญุต ุงูุฑุณุงุฆู
SELECT m.id, m.direction, m.body, m.created_at, c.phone 
FROM messages m 
JOIN conversations c ON m.conversation_id = c.id 
ORDER BY m.created_at DESC LIMIT 20;

-- ูุญุต webhook events
SELECT id, instance_id, created_at, response 
FROM webhook_events 
ORDER BY created_at DESC LIMIT 10;
```

## ๐๏ธ ุงูุญููู ุงูุดุงุฆุนุฉ

### 1. **ูุดููุฉ: "Instance not found"**
**ุงูุญู:**
- ุชุญูู ูู ุฃู ุงูู instance ID ุตุญูุญ
- ุชุฃูุฏ ูู ุฃู ุงูู instance ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. **ูุดููุฉ: "Invalid signature"**
**ุงูุญู:**
- ุชุญูู ูู ุงูู app secret ูู Settings
- ุชุฃูุฏ ูู ุฃู ุงูู signature header ููุฌูุฏ
- ุฃู ุฃุฒู ุงูู app secret ุฅุฐุง ูู ุชูู ุชุญุชุงุฌู

### 3. **ูุดููุฉ: "No events parsed from payload"**
**ุงูุญู:**
- ุชุญูู ูู ูููู ุงูู payload ูู Meta
- ุชุฃูุฏ ูู ูุฌูุฏ `entry` ู `changes` ู `messages`
- ุงุณุชุฎุฏู ุฃุฏุงุฉ Debug Webhook ููุญุต ุงูู payload

### 4. **ูุดููุฉ: ุงูุฑุณุงุฆู ูุง ุชุธูุฑ ูู ุงูุชุทุจูู**
**ุงูุญู:**
- ุชุญูู ูู ุงุชุตุงู WebSocket
- ุชุฃูุฏ ูู ุฃู ุงูุฑุณุงุฆู ูุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุญูู ูู console ุงููุชุตูุญ ููุฃุฎุทุงุก

### 5. **ูุดููุฉ: ุงูู webhook ูุง ูุณุชูุจู ุทูุจุงุช**
**ุงูุญู:**
- ุชุญูู ูู ุงูู webhook URL ูู Meta
- ุชุฃูุฏ ูู ุฃู ุงูุฎุงุฏู ูุชุงุญ ูู ุงูุฅูุชุฑูุช
- ุชุญูู ูู firewall settings

## ๐ ุทูุจ ุงููุณุงุนุฏุฉ

ุฅุฐุง ูู ุชุญู ุงููุดููุฉุ ูุฏู ูุฐู ุงููุนูููุงุช:

1. **ูุชุงุฆุฌ ุตูุญุฉ ุงูุชุดุฎูุต** (screenshot)
2. **ุฑุณุงุฆู ุงูุฎุทุฃ** ูู console ุงูุฎุงุฏู
3. **ูุนูููุงุช ุงูู instance** (ุจุฏูู ุจูุงูุงุช ุญุณุงุณุฉ)
4. **ุฎุทูุงุช ุฅุนุงุฏุฉ ุงูุฅูุชุงุฌ**

---

## ๐ฏ ูุตุงุฆุญ ูููุฉ

1. **ุงุณุชุฎุฏู ุฃุฏุงุฉ ุงูุชุดุฎูุต ุฃููุงู** ูุจู ุงูุจุญุซ ุนู ุญููู ุฃุฎุฑู
2. **ุชุญูู ูู Logs** ูู console ุงูุฎุงุฏู
3. **ุงุฎุชุจุฑ ุงูุฅุฑุณุงู** ูุจู ุงูุชุฑููุฒ ุนูู ุงูุงุณุชูุงู
4. **ุชุญูู ูู ุฅุนุฏุงุฏุงุช Meta** ุฅุฐุง ูู ุชุตู webhook events
5. **ุงุณุชุฎุฏู Debug Webhook** ูููู ูููู ุงูุจูุงูุงุช

ูุฐุง ุงูุฏููู ูุฌุจ ุฃู ูุณุงุนุฏู ูู ุญู ูุนุธู ูุดุงูู ุงุณุชูุงู ุงูุฑุณุงุฆู. ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุงุณุชุฎุฏู ุงููุนูููุงุช ุงููุฌูุนุฉ ูุทูุจ ุงููุณุงุนุฏุฉ.
